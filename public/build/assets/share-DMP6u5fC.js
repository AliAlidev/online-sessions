import{g as f}from"./auth-CrJnzGtq.js";async function y(){var e,n;const t=await f();try{if(!(await fetch("/events/check-token",{method:"GET",headers:{pageToken:t}})).ok)throw new Error("Unauthorized")}catch{window.location.href=((n=(e=document.getElementById("main-page-url"))==null?void 0:e.dataset)==null?void 0:n.url)||"/"}}y();async function b(){var t=$("#global-event-data").val(),e=$("#global-event-data").data("eventGalleryUrl");if($("#global-event-data").data("eventHasP"))if(localStorage.getItem(t)){var n=await f();axios.post(e,{_token:document.querySelector('meta[name="csrf-token"]').getAttribute("content"),password:localStorage.getItem(t)},{headers:{pageToken:n}}).then(a=>{a.data.success?setTimeout(()=>{document.querySelector(".main-container").classList.remove("auth-checking")},10):g()}).catch(a=>{g()})}else g();else setTimeout(()=>{document.querySelector(".main-container").classList.remove("auth-checking")},10)}b();async function g(){var t=$("#global-event-data").data("url"),e=await f();axios.get(t,{headers:{pageToken:e}}).then(n=>{window.location.href=n.data.url}).catch(n=>{console.log(n)})}const l=document.getElementById("dropArea"),u=document.getElementById("image"),m=document.getElementById("thumbnails");l.addEventListener("click",()=>{u.click()});u.addEventListener("change",v);l.addEventListener("dragover",t=>{t.preventDefault(),l.classList.add("dragover")});l.addEventListener("dragleave",()=>{l.classList.remove("dragover")});l.addEventListener("drop",t=>{t.preventDefault(),l.classList.remove("dragover"),u.files=t.dataTransfer.files,v()});function v(){const t=u.files;if(m.innerHTML="",t.length>0){m.style.marginTop="15px";for(const e of t)if(e&&e.type.startsWith("image/")){const n=new FileReader;n.onload=function(a){const s=document.createElement("img");s.src=a.target.result,m.appendChild(s)},n.readAsDataURL(e)}}else m.style.marginTop="0"}function h(){const t=document.getElementById("overlay");t.classList.remove("show"),t.addEventListener("transitionend",()=>{t.classList.add("hidden")},{once:!0})}document.getElementById("closeModalBtn").addEventListener("click",h);document.getElementById("closeXBtn").addEventListener("click",h);$("#uploadForm").submit(function(t){t.preventDefault(),$(".alert").remove(),$(".image-error").attr("hidden",!0);var e=$("#storeButton");x(e);var n=$("#image-compressed")[0].files[0];if(!n)return $(".image-error").attr("hidden",!1),$(".image-error").text("Please select image"),p(e),!1;var a=$("#uploadProgressModal #progressContainer");const s=document.getElementById("overlay");s.classList.remove("hidden"),setTimeout(()=>s.classList.add("show"),10),a.empty();let d=$(`
                <div class="mb-4" id="file-container-0" style="margin-top:10px">
                    <p class="mb-0">Stage1: File Upload ${n.name}</p>
                    <div class="progress" style="margin-top:10px">
                        <div class="progress-bar progress-bar-striped progress-bar-animated bg-success"
                            role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"
                            style="width: 0%;" id="progress-bar-0"></div>
                    </div>
                    <p id="status-0" class="text-danger d-inline-block mt-3" style="text-align:start; margin-top:10px"></p>
                    <button class="btn btn-sm btn-warning retry-btn hidden-force mt-3" style="height:15px; width:auto; font-size:12px; margin-top:10px; text-align:start" data-index="0">Retry</button>
                </div>
            `);a.append(d),w(n,0).then(i=>{var c;clearInterval($("#status-0").data("interval")),$("#progress-bar-0").removeClass("bg-success").addClass("bg-primary").text("Completed"),$("#status-0").addClass("hidden-force"),p(e),$("#uploadForm")[0].reset(),document.getElementById("thumbnails").innerHTML="";const o=((c=i.data)==null?void 0:c.message)||"Upload completed successfully",r=$(`<div class="alert alert-success" style="margin-top:40px; margin-bottom:30px">${o}</div>`);$("#uploadProgressModal").prepend(r),$("#uploadProgressModalLabel").attr("hidden",!0)}).catch(i=>{p(e),console.error("Upload failed:",i)})});async function w(t,e,n){let a=new FormData;a.append("file",t);var s=$('meta[name="csrf-token"]').attr("content"),d=$("#event_id").data("id");a.append("_token",s),a.append("user_name",$("#user_name").val()),a.append("description",$("#caption").val()),a.append("file_size",$("#file_size").val()),a.append("event_id",d);var i=document.getElementById("share-post-btn").dataset.url;$(`#file-container-${e} .start-btn`).remove();try{return await axios.post(i,a,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:function(r){if(r.lengthComputable){const c=Math.round(r.loaded/r.total*100);$(`#progress-bar-${e}`).css("width",c+"%").text(c+"%"),c===100&&B(0)}},timeout:3e4})}catch(o){let r=$("#status-"+e);throw r.text("Stage2: Failed"),clearInterval(r.data("interval")),E(0),o}}function B(t){let e=$("#status-"+t),n=0;e.removeClass("hidden-force"),e.text("Stage2: Processing");let a=setInterval(()=>{n=(n+1)%4,e.text("Stage2: Processing"+".".repeat(n))},500);e.data("interval",a)}function E(t){$(`#file-container-${t} .retry-btn`).removeClass("hidden-force")}function x(t){const e=document.getElementById("spinner");e.style.display="inline-block",t.disabled=!0}function p(t){const e=document.getElementById("spinner");e.style.display="none",t.disabled=!1}$("#image").on("change",function(t){I()});function I(){const e=document.getElementById("image").files;if(!e.length)return;const n=500,a=new DataTransfer;Array.from(e).forEach(s=>{const d=s.size/1024;if(d<=n){a.items.add(s),a.files.length===e.length&&(document.getElementById("image-compressed").files=a.files,document.getElementById("file_size").value=s.size);return}const i=Math.max(.98,n/d);new Compressor(s,{quality:i,maxWidth:1024,maxHeight:1024,success(o){const r=new File([o],s.name,{type:s.type,lastModified:Date.now()});a.items.add(r),a.files.length===e.length&&(document.getElementById("image-compressed").files=a.files,document.getElementById("file_size").value=r.size)},error(o){console.error("Compression error:",o)}})})}
