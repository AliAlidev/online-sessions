import{g as f}from"./auth-CrJnzGtq.js";async function h(){var e,n;const t=await f();try{if(!(await fetch("/events/check-token",{method:"GET",headers:{pageToken:t}})).ok)throw new Error("Unauthorized");setTimeout(()=>{document.querySelector(".main-container").classList.remove("auth-checking")},10)}catch{window.location.href=((n=(e=document.getElementById("main-page-url"))==null?void 0:e.dataset)==null?void 0:n.url)||"/"}}h();const l=document.getElementById("dropArea"),m=document.getElementById("image"),c=document.getElementById("thumbnails");l.addEventListener("click",()=>{m.click()});m.addEventListener("change",g);l.addEventListener("dragover",t=>{t.preventDefault(),l.classList.add("dragover")});l.addEventListener("dragleave",()=>{l.classList.remove("dragover")});l.addEventListener("drop",t=>{t.preventDefault(),l.classList.remove("dragover"),m.files=t.dataTransfer.files,g()});function g(){const t=m.files;if(c.innerHTML="",t.length>0){c.style.marginTop="15px";for(const e of t)if(e&&e.type.startsWith("image/")){const n=new FileReader;n.onload=function(a){const s=document.createElement("img");s.src=a.target.result,c.appendChild(s)},n.readAsDataURL(e)}}else c.style.marginTop="0"}$("#uploadForm").submit(function(t){t.preventDefault(),$(".alert").remove(),$(".image-error").attr("hidden",!0);var e=$("#storeButton");w(e);var n=$("#image-compressed")[0].files[0];if(!n)return $(".image-error").attr("hidden",!1),$(".image-error").text("Please select image"),p(e),!1;var a=$("#progressContainer");a.empty();let s=$(`
                <div class="mb-4" id="file-container-0">
                    <p class="mb-0">Stage1: File Upload ${n.name}</p>
                    <div class="progress mt-2">
                        <div class="progress-bar progress-bar-striped progress-bar-animated bg-success"
                            role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"
                            style="width: 0%" id="progress-bar-0"></div>
                    </div>
                    <p id="status-0" class="text-danger d-inline-block mt-1"></p>
                    <button class="btn btn-sm btn-warning retry-btn hidden-force" style="height:15px; width:auto; font-size:10px" data-index="0" style="font-size: 12px;">Retry</button>
                </div>
            `);a.append(s),v(n,0).then(i=>{var r;clearInterval($("#status-0").data("interval")),$("#progress-bar-0").removeClass("bg-success").addClass("bg-primary").text("Completed"),$("#status-0").addClass("hidden-force"),p(e),$("#uploadForm")[0].reset(),document.getElementById("thumbnails").innerHTML="";const d=((r=i.data)==null?void 0:r.message)||"Upload completed successfully",o=$(`<div class="alert alert-success">${d}</div>`);$("#uploadForm").closest(".upload-container").prepend(o),setTimeout(()=>{o.fadeOut(500,()=>o.remove())},5e3)}).catch(i=>{p(e),console.error("Upload failed:",i)})});async function v(t,e,n){let a=new FormData;a.append("file",t);var s=$('meta[name="csrf-token"]').attr("content"),i=$("#event_id").data("id");a.append("_token",s),a.append("user_name",$("#user_name").val()),a.append("description",$("#caption").val()),a.append("file_size",$("#file_size").val()),a.append("event_id",i);var d=document.getElementById("share-post-btn").dataset.url;$(`#file-container-${e} .start-btn`).remove();try{return await axios.post(d,a,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:function(r){if(r.lengthComputable){const u=Math.round(r.loaded/r.total*100);$(`#progress-bar-${e}`).css("width",u+"%").text(u+"%"),u===100&&y(0)}},timeout:3e4})}catch(o){let r=$("#status-"+e);throw r.text("Stage2: Failed"),clearInterval(r.data("interval")),b(0),o}}function y(t){let e=$("#status-"+t),n=0;e.removeClass("hidden-force"),e.text("Stage2: Processing");let a=setInterval(()=>{n=(n+1)%4,e.text("Stage2: Processing"+".".repeat(n))},500);e.data("interval",a)}function b(t){$(`#file-container-${t} .retry-btn`).removeClass("hidden-force")}function w(t){const e=document.getElementById("spinner");e.style.display="inline-block",t.disabled=!0}function p(t){const e=document.getElementById("spinner");e.style.display="none",t.disabled=!1}$("#image").on("change",function(t){B()});function B(){const e=document.getElementById("image").files;if(!e.length)return;const n=500,a=new DataTransfer;Array.from(e).forEach(s=>{const i=s.size/1024;if(i<=n){a.items.add(s),a.files.length===e.length&&(document.getElementById("image-compressed").files=a.files,document.getElementById("file_size").value=s.size);return}const d=Math.max(.98,n/i);new Compressor(s,{quality:d,maxWidth:1024,maxHeight:1024,success(o){const r=new File([o],s.name,{type:s.type,lastModified:Date.now()});a.items.add(r),a.files.length===e.length&&(document.getElementById("image-compressed").files=a.files,document.getElementById("file_size").value=r.size)},error(o){console.error("Compression error:",o)}})})}
